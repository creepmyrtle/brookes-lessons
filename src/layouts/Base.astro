---
import SEO from '../components/SEO.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  canonical?: string;
  ogImage?: string;
  ogType?: string;
  noindex?: boolean;
  article?: {
    publishedTime: string;
    modifiedTime?: string;
    author?: string;
    tags?: string[];
  };
}

const props = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <SEO {...props} />
  <slot name="head" />
</head>
<body>
  <Header />
  <main>
    <slot />
  </main>
  <Footer />

  <script>
    // Mobile menu toggle
    const hamburger = document.getElementById('hamburgerBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    if (hamburger && mobileMenu) {
      hamburger.addEventListener('click', () => {
        mobileMenu.classList.toggle('open');
      });
      // Close mobile menu when a link is clicked
      mobileMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu.classList.remove('open');
        });
      });
    }

    // Nav scroll shadow
    const nav = document.getElementById('mainNav');
    if (nav) {
      window.addEventListener('scroll', () => {
        nav.classList.toggle('scrolled', window.scrollY > 10);
      });
    }

    // Intersection Observer for fade-up animations
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) e.target.classList.add('visible');
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('.fade-up').forEach(el => observer.observe(el));

    // Hash redirect for old bookmarks (/#about â†’ /about, etc.)
    const hashRedirects: Record<string, string> = {
      '#home': '/',
      '#about': '/about',
      '#taylor-swift': '/taylor-swift-course',
      '#contact': '/book',
      '#blog': '/blog',
      '#listen': '/listen',
      '#policies': '/policies',
      '#gift': '/gift-certificates',
    };

    const hash = window.location.hash;
    if (hash && hashRedirects[hash]) {
      window.location.replace(hashRedirects[hash]);
    }
  </script>
</body>
</html>
